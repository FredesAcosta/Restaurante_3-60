{% extends "baseadmi.html" %}

{% block title %}Gesti√≥n de Empleados{% endblock %}

{% block content %}
<link rel="stylesheet" href="/static/CSS/styleEmp.css">

<!-- üü¶ MODAL -->
<div id="modalEmpleado" class="modal">
    <div class="modal-contenido">
        <span class="cerrar" onclick="cerrarModal()">&times;</span>

        <h2>Agregar Empleado / Administrador</h2>

       <form method="POST" action="{{ url_for('add_empleado') }}">
            <label>Nombre completo:</label>
            <input type="text" name="nombre" required>

            <label>Correo personal:</label>
            <input type="email" name="correo" required>

            <label>Tel√©fono:</label>
            <input type="tel" name="telefono" required>

            <label>Rol:</label>
            <select name="rol" required>
                <option value="Administrador">Administrador</option>
                <option value="Empleado">Empleado</option>
            </select>

            <label>Cargo:</label>
            <select name="cargo" required>
                <option value="Cajero">Cajero</option>
                <option value="Mesero">Mesero</option>
                <option value="Cocinero">Cocinero</option>
                <option value="Domiciliario">Domiciliario</option>
            </select>

            <label>Contrase√±a provisional:</label>
            <input type="password" name="contrasena" required>

            <button type="submit" class="btn-guardar">Guardar</button>
        </form>
    </div>
</div>

{% if mensaje %}
    <p class="msg">{{ mensaje }}</p>
{% endif %}
{% with mensajes = get_flashed_messages(with_categories=true) %}
    {% if mensajes %}
        {% for categoria, mensaje in mensajes %}
            <div class="mensaje-flash {{ categoria }}">
                {{ mensaje }}
            </div>
        {% endfor %}
    {% endif %}
{% endwith %}
<h2>Lista de Empleados</h2>
<!-- BOT√ìN PARA ABRIR EL MODAL -->
 <div class="modal-content">
    <button class="btn-abrir" onclick="abrirModal()">Agregar Empleado</button>
 </div>
<table border="1" class="tabla-empleados">
    <tr>
        <th>ID</th>
        <th>Nombre</th>
        <th>Correo</th>
        <th>Rol</th>
        <th>Cargo</th>
    </tr>
    {% for emp in empleados %}
    <tr>
        <td>{{ emp.id_usuario }}</td>
        <td>{{ emp.nombre }}</td>
        <td>{{ emp.correo }}</td>
        <td>{{ emp.nombre_rol }}</td>
        <td>{{ emp.cargo }}</td>
    </tr>
    {% endfor %}
</table>

<!-- SCRIPTS DEL MODAL -->
<script>
     function abrirModal() {
        document.getElementById("modalEmpleado").style.display = "block";
    }
    function cerrarModal() {
        document.getElementById("modalEmpleado").style.display = "none";
    }

    window.onclick = function(event) {
        let modal = document.getElementById("modalEmpleado");
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }

    //Cerrar modal autom√°ticamente si se registr√≥ un empleado
    document.addEventListener("DOMContentLoaded", function () {
        let mensajes = document.querySelectorAll(".mensaje-flash.success");
        if (mensajes.length > 0) {
            cerrarModal();
        }
    });
</script>

{% endblock %}
